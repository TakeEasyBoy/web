var swfUpload=function(B,C){var A=this;this.uploadCount=5;this.panelId=B;this.resource=C;this.uploadCtl=null;this.settings=null;this.onerror=null;this.onsuccess=null;this.onstart=null;this.onqueued=null;this.oncompleted=null;this.ondialogcompleted=null;this.onqueued=null;this.onqueuecomplete=null;this.onfileloading=null;this.uploadedImageIndex=0;this.fileloading=function(D){if(typeof D==="function"){A.onfileloading=D}return A};this.queuecomplete=function(D){if(typeof D==="function"){A.onqueuecomplete=D}return A};this.queued=function(D){if(typeof D==="function"){A.onqueued=D}return A};this.success=function(D){if(typeof D==="function"){A.onsuccess=D}return A};this.error=function(D){if(typeof D==="function"){A.onerror=D}return A};this.start=function(D){if(typeof D==="function"){A.onstart=D}return A};this.dialogcompleted=function(D){if(typeof D==="function"){A.ondialogcompleted=D}return A};this.bind=function(){A.settings={flash_url:A.resource.flash_url,upload_url:A.resource.upload_url,post_params:{action:"Promotion",filekey:"uploadfile",keyID:A.resource.promotionSysNo,uploadkey:A.resource.uploadkey,userID:A.resource.userid+""},file_size_limit:this.resource.file_size_limit||"500",file_post_name:this.resource.file_post_name||"uploadfile",file_types:"*.gif;*.jpg;*.jpeg",file_types_description:"*.gif;*.jpg;*.jpeg",file_upload_limit:5,file_queue_limit:0,custom_settings:{progressTarget:"fsUploadProgress",cancelButtonId:"btnCancel"},debug:false,button_image_url:A.resource.button_image_url,button_width:"69",button_height:"25",button_placeholder_id:A.panelId,button_cursor:SWFUpload.CURSOR.HAND,file_queued_handler:A.onqueued,file_queue_error_handler:A.onerror,file_dialog_complete_handler:A.ondialogcompleted||fileDialogComplete,upload_start_handler:A.onstart,upload_success_handler:A.onsuccess,upload_complete_handler:A.oncompleted,queue_complete_handler:A.onqueuecomplete,upload_progress_handler:A.onfileloading};if(document.getElementById(A.panelId)){A.uploadCtl=new SWFUpload(A.settings)}return A}};var promotionTimer;function showPromotionErrorInfo(A){$("#errorInfo").show().children("dd").html("<span class='error'><span>"+A+"</span></span>");if(promotionTimer){clearTimeout(promotionTimer)}promotionTimer=setTimeout(function(){$("#errorInfo").hide();clearTimeout(promotionTimer);delete promotionTimer},3000)}function textChange(D){var C=D.value;var B=300-C.length;if(C.length>300){B=0;D.value=C.substring(0,300);D.value+=""}var A=$("#couldInput").text();A=A.replace(/[\d]+/,B);$("#couldInput").text(A)}var currentUpload=0;$(function(){var flg=$.newegg.cookie.get("CustomerLogin","SysNo");if(!flg){$("#nologin").show();$("#errorInfo").show();return}window.submitLock=null;$("#btnSave:not(.btnDisable)").live("click",function(){if(submitLock!==null){return}$("#guideBtnSaveTip").hide();var customerInput=$.trim($("textarea[name=textarea]").val());if(customerInput==""){showPromotionErrorInfo(resources_Msg.ContentError);return}else{if(customerInput.length>1000){showPromotionErrorInfo(resources_Msg.ContentLength);return}}$("#errorInfo").hide();submitLock=true;$(".operationLoading").show();$("#btnSave").addClass("btnDisable");var uploadFile="";$("#uploadedFileList p[path!='']").each(function(){uploadFile+=$(this).attr("path")+"|"});uploadFile=uploadFile.length>0?uploadFile.substr(0,uploadFile.length-1):uploadFile;var data=$("#insertReplyForm").serialize();data+="&uploadFile="+uploadFile;data+="&ecodeContent="+escape($("#txtReplyContent").val());$.ajax({url:$.newegg.buildWWW("Ajax/FeedBack/AjaxPromotionReply.aspx?action=addReply"),data:data,type:"post",cache:false,success:function(str){str=str+"";if(str==="1"){try{upload.uploadCtl.setFileUploadLimit((currentUpload+5))}catch(e){}$("#uploadedFileList").html("");$("#insertReplyForm textarea").val("");$("#guideBtnSaveTip").show();$("#txtReplyContent").change();setTimeout(function(){$("#guideBtnSaveTip").hide()},3000)}else{showPromotionErrorInfo(resources_swfUpload.fileUploadUnknownError,true)}},complete:function(){$("#btnSave").removeClass("btnDisable");$(".operationLoading").hide();submitLock=null}})});$("a.uploadDelLink").live("click",function(){upload.uploadCtl.setFileUploadLimit(++upload.uploadCount);$("#btnSave").removeClass("btnDisable");var index=$(this).attr("index");var parent=$("#uploadedFileList");if($.browser.msie){$("p[index='"+index+"']").html("")[0].removeNode()}else{parent[0].removeChild($("p[index='"+index+"']")[0])}});$("#txtReplyContent").val("");var inputCount=0;var inputMax=Number($("#hidMaxInput").val());$("#txtReplyContent").keyup(function(){textChange(this)}).mouseup(function(){textChange(this)}).change(function(){textChange(this)});$.ajax({url:$.newegg.buildWWW("Ajax/FeedBack/AjaxPromotionReply.aspx?action=getUploadKey&commonCid=1153&sysno="+resources_swfUpload.promotionSysNo),cache:false,complete:function(request){if(request.status!==200){$("#nologin").show();$("#errorInfo").show();return}var array=request.responseText.split("|");if(array.length!==2){return}var requestKey=array[0],userid=array[1];$("#logined").show();$("#btnSave").removeClass("btnDisable");resources_swfUpload.uploadkey=requestKey;resources_swfUpload.userid=userid;window.upload=new swfUpload("reviewSpanButtonPlaceHolder",resources_swfUpload).fileloading(function(settings,now,size){var process=(now/size)*100;$("div.progressbar").width(process+"%")}).start(function(){$("div.uploading").show().find("div.progressbar").width("0%")}).error(function(file,errorCode,message){if(typeof upload.uploadCtl==="undefined"){return}switch(errorCode){case SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED:showPromotionErrorInfo(upload.resource.fileQueueLimitError);break;case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:showPromotionErrorInfo(upload.resource.fileSizeLimitError);break;case SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE:showPromotionErrorInfo(upload.resource.fileZeroByteError);break;case SWFUpload.QUEUE_ERROR.INVALID_FILETYPE:showPromotionErrorInfo(upload.resource.fileTypeError);break;default:if(file!==null){showPromotionErrorInfo(upload.resource.fileUploadUnknownError)}break}}).success(function(file,json){upload.uploadedImageIndex++;$("div.uploading").hide();try{json=eval("("+json+")")}catch(ex){}if(typeof(json)==="undefined"||typeof(json.info)==="undefined"){upload.uploadCtl.setFileUploadLimit(++upload.uploadCount);showPromotionErrorInfo(upload.resource.uploadFailed);return}if(json.info=="OK"){var html=$("<div></div>").append($("#fileTemplate").clone()).html();html=html.replace("fileTemplate","");html=html.replace("@fileName",file.name.slice(0,file.name.length-4).slice(0,40)+file.name.slice(file.name.length-4,file.name.length));html=html.replace("@fileSize",json.length);html=html.replace("@path",json.file);html=html.replace(/@imageIndex/g,upload.uploadedImageIndex);html=html.replace("show","");if($.browser.msie){html=html.replace("id=","")}$("#uploadedFileList").append(html);$("#uploadedFileList p[istemplate='']").show();currentUpload++}else{upload.uploadCtl.setFileUploadLimit(++upload.uploadCount);if(json.info=="InvalidFileType"){showPromotionErrorInfo(upload.resource.invalidFileType)}else{if(json.info=="MaxUploadLimited"){showPromotionErrorInfo(upload.resource.uploadedImageTooBig)}else{if(json.info=="LimitedSize"){showPromotionErrorInfo(upload.resource.uploadedImageTooSmall)}else{showPromotionErrorInfo(upload.resource.uploadFailed)}}}}}).bind()}})});function selectTag(F,E,D){var B=$(F);var A=$(E);var C="selectTag";B.each(function(G){$(this).click(function(){B.removeClass(C);A.removeClass(C);B.eq(G).addClass(C);A.eq(G).addClass(C);$(D).removeClass(C);$(D).eq(G).addClass(C)})});A.each(function(G){$(this).click(function(){B.eq(G).click()})})}$(window).load(function(){selectTag("#tags li","#tags_bottom li",".tagContent")});function ShowPic(A){var B=$(A);if(B.length){B.children("img").addClass("show");B.mouseout(function(){B.children("img").removeClass("show")})}}$(function(){function A(){var C=$("#sharrwrap").offset().top;var B=document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop;if(B>C){$("#share").css({position:"absolute",top:B}).animate({top:B},{duration:220,queue:false})}else{$("#share").css({position:"static"})}}A();$(window).bind("scroll resize",function(){A()})});$(function(){var A=function(G,E){var E=E||0;var G=$(G);var D=document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop;var F=D>E?D+10:E;G.animate({top:F},{queue:false,duration:200})};var C=$("#body").offset().top+60;A(".sidenav",C);var B=($(window).width()-980)/2-$(".sidenav").outerWidth()-10;B=B>0?B:1;$(".sidenav").css({right:B,display:"block"});$(window).bind("scroll resize",function(){A(".sidenav",C);B=($(window).width()-980)/2-$(".sidenav").outerWidth()-10;B=B>0?B:1;$(".sidenav").css({right:B})})});